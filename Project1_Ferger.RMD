---
title: 'DATA 612: Project 1 | Global Baseline Predictors and RMSE'
author: "Amber Ferger"
date: "6/3/2020"
output: html_document
---


In this first assignment, we’ll attempt to predict ratings with very little information. We’ll first look at just raw averages across all (training dataset) users. We’ll then account for “bias” by normalizing across users and across items.  
  
You’ll be working with ratings in a user-item matrix, where each rating may be (1) assigned to a training dataset, (2) assigned to a test dataset, or (3) missing.


### Load Libraries
```{r, message=FALSE}

library(tidyverse)

```

### Load Data, develop base set
```{r}

rawData <- data.frame(read.csv("ratings_small.csv"))

# top 10 movies
top10 <- rawData %>%
  group_by(movieId) %>%
  summarize(TOTAL_RATINGS = n()) %>%
  arrange(desc(TOTAL_RATINGS)) %>%
  mutate(RECORD_ID = as.numeric(rownames(.))) %>%
  filter(RECORD_ID <= 10)

# all users that have at least 1 of the top 10 movies
dataSubset <- inner_join(rawData, top10, by=c('movieId'='movieId'))

# user IDs to be used in final dataset
sampledData <- dataSubset %>%
  group_by(userId) %>%
  summarize(MOVIE_COUNT = n()) %>%
  filter(MOVIE_COUNT >= 6) %>%
  group_by(MOVIE_COUNT) %>% 
  sample_n(2)

# final data set in long format
finalData <- inner_join(dataSubset, sampledData, by=c("userId" = "userId")) %>%
  select(userId,movieId,rating)

# final data matrix
finalData.df <- spread(finalData,movieId,rating)
head(finalData.df)

```

### Split Data into Training and Test

```{r}

# gather data -- long format
allValues <- gather(finalData.df,movieId,rating, -userId)

testSet <- allValues %>%
  filter(!is.na(rating)) %>% # do not include nulls
  group_by(userId) %>%
  sample_n(1)

trainingSet <- anti_join(allValues, testSet, by=c('userId'='userId', 'movieId'='movieId')) 

```